<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulasi Investasi - Login</title>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  margin:0; padding:0; font-family:'Segoe UI',sans-serif;
  background: linear-gradient(135deg,#1E88E5,#42A5F5); height:100vh;
  display:flex; justify-content:center; align-items:center;
}

.card {
  background:white; border-radius:12px; padding:30px;
  max-width:400px; width:90%; box-shadow:0 10px 30px rgba(0,0,0,0.2);
  transition:0.3s; text-align:center;
}

.card:hover { transform: translateY(-5px); box-shadow:0 15px 35px rgba(0,0,0,0.3); }

h2 { margin-bottom:20px; color:#1E88E5; }

input { width:100%; padding:12px; margin:10px 0; border-radius:8px; border:1px solid #ccc; }
button { width:100%; padding:12px; margin:10px 0; border:none; border-radius:8px;
         background:#1E88E5; color:white; font-weight:bold; cursor:pointer; transition:0.3s; }
button:hover { background:#1565C0; }

a { color:#1E88E5; cursor:pointer; text-decoration:none; }
a:hover { text-decoration:underline; }

#registerContainer { display:none; margin-top:15px; }
</style>
</head>
<body>

<div class="card">
  <h2 id="cardTitle">Login</h2>
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="password" placeholder="Password">
  <button id="actionBtn" onclick="login()">Login</button>
  <p id="toggleText">Belum punya akun? <a onclick="showRegister()">Daftar</a></p>

  <div id="registerContainer">
    <input type="text" id="regUsername" placeholder="Username">
    <input type="password" id="regPassword" placeholder="Password">
    <button onclick="register()">Daftar Sekarang</button>
  </div>
</div>

<script>
// ========== KONFIGURASI FIREBASE ==========
const firebaseConfig = {
  apiKey: "AIzaSyDAkDFS1Mp8zAJvXq8P8SkzJnmbZRyHKaY",
  authDomain: "testingsaja-bb474.firebaseapp.com",
  databaseURL: "https://testingsaja-bb474-default-rtdb.firebaseio.com",
  projectId: "testingsaja-bb474",
  storageBucket: "testingsaja-bb474.appspot.com",
  messagingSenderId: "1068578641763",
  appId: "1:1068578641763:web:3832c9485c5092df3b6556",
  measurementId: "G-PF9N37F8V9"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const usersRef = db.ref('users');

// ========== FUNGSIONALITAS ==========
function showRegister(){
  document.getElementById('registerContainer').style.display='block';
  document.getElementById('cardTitle').innerText='Daftar Akun';
  document.getElementById('actionBtn').style.display='none';
  document.getElementById('toggleText').style.display='none';
}

// REGISTER
function register(){
  let u = document.getElementById('regUsername').value.trim();
  let p = document.getElementById('regPassword').value;
  if(!u || !p){ alert("Isi username dan password!"); return; }

  usersRef.child(u).get().then(snapshot=>{
    if(snapshot.exists()){
      alert("Username sudah terdaftar!");
      return;
    }
    let newUser = {
      password: p,
      balance:0,
      investments:[],
      reloadHistory:[],
      withdrawHistory:[],
      dailyWithdraw:{},
      blocked:false
    };
    usersRef.child(u).set(newUser).then(()=>{
      alert("Pendaftaran berhasil! Silakan login.");
      // otomatis isi login form dan submit
      document.getElementById('username').value = u;
      document.getElementById('password').value = p;
      login();
    });
  });
}

// LOGIN
function login(){
  let u = document.getElementById('username').value.trim();
  let p = document.getElementById('password').value;
  if(!u || !p){ alert("Lengkapi username dan password!"); return; }

  usersRef.child(u).get().then(snapshot=>{
    if(!snapshot.exists()){
      alert("Username tidak ditemukan!"); return;
    }
    let user = snapshot.val();
    if(user.password!==p){ alert("Password salah!"); return; }
    if(user.blocked){ alert("Akun Anda diblokir!"); return; }

    localStorage.setItem('currentUser', u);
    window.location.href="index.html"; // langsung ke halaman utama
  });
}
</script>

</body>
</html>
